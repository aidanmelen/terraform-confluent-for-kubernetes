# confluent_platform_tls_only

Deploy the Confluent Platform with with full TLS network encryption. This Terraforms [confluent-for-kubernetes-examples/security/autogenerated-tls_onlyl](https://github.com/confluentinc/confluent-kubernetes-examples/tree/master/security/autogenerated-tls_only).

## Assumptions

This example assumes you have a Kubernetes cluster running locally on Docker Desktop. Please see [Docker's official documentation](https://docs.docker.com/desktop/kubernetes/) for more information.

<!-- BEGINNING OF PRE-COMMIT-TERRAFORM DOCS HOOK -->

## Example

```hcl
module "confluent_platform_tls_only" {
  source  = "aidanmelen/confluent-platform/kubernetes"
  version = ">= 0.8.0"

  namespace = kubernetes_namespace_v1.namespace.metadata[0].name

  confluent_operator = {
    create_namespace = false
  }

  zookeeper = yamldecode(<<-EOF
    spec:
      tls:
        # For this component, Confluent for Kubernete will autogenerate and
        # configure server certs, using a certificate authority specified in
        # the secret `ca-pair-sslcerts`.
        # This same configuration is specified for all other components.
        autoGeneratedCerts: true
    EOF
  )

  kafka = yamldecode(<<-EOF
    spec:
      tls:
        autoGeneratedCerts: true
      listeners:
        internal:
          # The `internal` listener will be TLS enabled.
          tls:
            enabled: true
            # Since no secretRef is specified, the Kafka auto-generated tls
            # configuration specified above will be used for this listener.
      metricReporter:
        enabled: true
        bootstrapEndpoint: kafka:9071
        tls:
          enabled: true
      dependencies:
        zookeeper:
          endpoint: zookeeper.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:2182
          tls:
            enabled: true
    EOF
  )

  # connect = yamldecode(<<-EOF
  #   spec:
  #     tls:
  #       autoGeneratedCerts: true
  #     dependencies:
  #       kafka:
  #         bootstrapEndpoint: kafka:9071
  #         tls:
  #           enabled: true
  #   EOF
  # )

  # ksqldb = yamldecode(<<-EOF
  #   spec:
  #     tls:
  #       autoGeneratedCerts: true
  #     dependencies:
  #       kafka:
  #         bootstrapEndpoint: kafka:9071
  #         tls:
  #           enabled: true
  #   EOF
  # )

  controlcenter = yamldecode(<<-EOF
    spec:
      tls:
        autoGeneratedCerts: true
      dependencies:
        kafka:
          bootstrapEndpoint: kafka.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:9071
          tls:
            enabled: true
        schemaRegistry:
          url: https://schemaregistry.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:8081
          tls:
            enabled: true
        ksqldb:
        - name: ksql
          url: https://ksqldb.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:8088
          tls:
            enabled: true
        connect:
        - name: connect-dev
          url:  https://connect.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:8083
          tls:
            enabled: true
    EOF
  )

  # schemaregistry = yamldecode(<<-EOF
  #   spec:
  #     tls:
  #       autoGeneratedCerts: true
  #     dependencies:
  #       kafka:
  #         bootstrapEndpoint: kafka:9071
  #         tls:
  #           enabled: true
  #   EOF
  # )

  # kafkarestproxy = yamldecode(<<-EOF
  #   spec:
  #     tls:
  #       autoGeneratedCerts: true
  #     dependencies:
  #       schemaRegistry:
  #         url: https://schemaregistry.${kubernetes_namespace_v1.namespace.metadata[0].name}.svc.cluster.local:8081
  #         tls:
  #           enabled: true
  #   EOF
  # )
}

module "kafka_rest_class" {
  source  = "aidanmelen/confluent-platform/kubernetes"
  version = ">= 0.8.0"

  name      = "default"
  namespace = kubernetes_namespace_v1.namespace.metadata[0].name
}
```

## Requirements

| Name | Version |
|------|---------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) | >= 0.14.8 |
| <a name="requirement_helm"></a> [helm](#requirement\_helm) | >= 2.0.0 |
| <a name="requirement_kubernetes"></a> [kubernetes](#requirement\_kubernetes) | >= 2.12.1 |
| <a name="requirement_tls"></a> [tls](#requirement\_tls) | >= 4.0.1 |
## Modules

| Name | Source | Version |
|------|--------|---------|
| <a name="module_confluent_platform_tls_only"></a> [confluent\_platform\_tls\_only](#module\_confluent\_platform\_tls\_only) | ../../ | n/a |
| <a name="module_kafka_rest_class"></a> [kafka\_rest\_class](#module\_kafka\_rest\_class) | ../../modules/kafka_rest_class | n/a |
## Inputs

| Name | Description | Type | Default | Required |
|------|-------------|------|---------|:--------:|
| <a name="input_namespace"></a> [namespace](#input\_namespace) | The namespace to release the Confluent Operator and Confluent Platform into. | `string` | `"confluent"` | no |
## Outputs

No outputs.
<!-- END OF PRE-COMMIT-TERRAFORM DOCS HOOK -->
